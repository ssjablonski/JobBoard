version: '3.8'
services:
  # app:
  #   build:
  #     context: .
  #   image: nextjs-dev
  #   ports:
  #     - "3000:3000"
  #   environment:
  #     NODE_ENV: development
  #     KEYCLOAK_CLIENT_ID: nextClient
  #     KEYCLOAK_CLIENT_SECRET: Fkr6DgMClVGj7w5KyQ2SaJNdAFk25HAE
  #     KEYCLOAK_ISSUER: http://keycloak:8080/realms/myrealm   # Adjust if needed
  #   depends_on:
  #     - keycloak
  #   networks:
  #     - keycloak-network
  db:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: next
      POSTGRES_PASSWORD: next
      POSTGRES_DB: next
    ports:
      - "5432:5432"
    networks:
      - keycloak-network

  keycloak:
    image: quay.io/keycloak/keycloak:21.1.1
    ports:
      - "8080:8080"
    command: 
      - "-v"
      - "start-dev"
      - "--import-realm"
    environment:
      - KEYCLOAK_ADMIN=admin
      - KEYCLOAK_ADMIN_PASSWORD=admin 
    volumes:
      - ./keycloak:/opt/keycloak/data/import
    networks:
      - keycloak-network

networks:
  keycloak-network:
    driver: bridge
